
------Django Admin,Model Validation, Query Set, Field Lookup Demo--------


# in apps folder first we make models
# --> models.Model that means Model is being inherited.
# models.py 

from django.db import models

class UserBio(models.Model):
      name = models.CharField(max_length=100)
      email = models.EmailField()
      age = models.IntegerField()
      
      bio = models.CharField(max_length=200)


----------clearing our databases-----------
# python3 manage.py makemigrations
>>> (venv) dilli@acer-g41:/media/dilli/SSD 1/IW-BootCamp/Projects/django/>>>helloworld$ python3 manage.py makemigrations
>>>Migrations for 'modelextra':
  modelextra/migrations/0001_initial.py
    - Create model UserBio

#-----after the completion of migration we do migrate----------

(venv) dilli@acer-g41:/media/dilli/SSD 1/IW-BootCamp/Projects/django/helloworld$ python3 manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, modelextra, sessions
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying auth.0012_alter_user_first_name_max_length... OK
  Applying modelextra.0001_initial... OK
  Applying sessions.0001_initial... OK

--------------------------------------------------------------------------

-----------------registering models to admin.py------------------
# Now we import the models in our admin.py which is our app folder.
# admin.py in app folder
from django.contrib import admin
from modelextra.models import UserBio

admin.site.register(UserBio)
-----------------------------------------------------------------
------------root urls.py------------------
# By default we have if not then we can mannually code it.
from django.contrib import admin
urlpatterns = [
  path('admin/', admine.site.urls),
   ]

--------now run the server------------
>>>python3 manage.py runserver

----hit link--http://127.0.0.1:8000/admin/-----
# admin login UI will appear in the browser.
# we donot know or have the user name and password to login

-------Create up user to login django admin------------
# for that we have cmd and db-table where we can find auth_user automatically
# because django made it for us.


--#Now to enter the django admin we need to create a user 
# for that we have cmd 
dilli@acer-g41:/media/dilli/SSD 1/IW-BootCamp/Projects/django/helloworld$ python3 manage.py createsuperuser
Username (leave blank to use 'dilli'): 
Email address: admin@gmail.com
Password: 
Password (again): 
Superuser created successfully. 
----------------------------------------------------
http://127.0.0.1:8000/admin/
# enter the username and password then the UI of django admin is displayed.
--------add a user in userbios and we must make blank true 
----- bio = models.CharField(max_length=200, blank=True)
---- to let the field blank if not done django will not allow to leave it blank

-----Userobject(1)--------
# customizing it with readabel format
# overriding the .__str__ method
def __str__(self):
     return self.name

# ---Now lets create manually users in our UserBio database.
# we added more 4 persons with age and gmail id.
# go to database extramodel and click on showtable
# SQLite table will be like this.
id	name	email	                age	bio
1	Ram	eraeren715@gmail.com	19	
2	Peter	peter@gmail.com	        18	
3	hari	hari@gmail.com	        20	
4	sita	sitar@gmail.com	        22	
5	albert	albert@gmail.com	15	

----NOw lets add model validation in the fields-----
# Conditions and cases
# creating a custom validators.

# here first we import try exception functions for raising exceptions error

# then we create our custom validators by creating function first

# then we put the age as argument which is coming from class UserBio's age

# then if condition is not meet then we raise an exception validationerror

# then we put the validators inside the age filed with passing iterables ie.list inside it.
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
from django.db import models
from django.core.exceptions import ValidationError

def validate_my_age(age):
     if age < 20:
          raise ValidationError("Your age should be more than or equals to 20.")


class UserBio(models.Model):
      name = models.CharField(max_length=100)
      email = models.EmailField()
      age = models.IntegerField(validators=[validate_my_age])
      
      bio = models.CharField(max_length=200, blank=True)

---After that we migrate the models to databases although django itself make ready the models migrations 
----- but django doesnot push the migrations that it made ready for us.
---- so we push it to database with cmd python3 manage.py makemigrations
-----------------python3 manage.py migrate------------

>>> now open shell 
>>> python3 manage.py shell
>>>> from modelextra.models import UserBio
# now lets create an object
>>> obj = UserBio()
>>> obj.name = "John"
>>> obj.email = "john@gmail.com"
>>> obj.age = 2
>>> obj.save()
# here no error will raise bcoz we are directly hitting ORM and saving an object to the database. with obj.save() from shell.
# so the my_age_validators will not run on this case.

--------------------------------------------------------------
In [7]: obj.full_clean()
---------------------------------------------------------------------------
ValidationError                           Traceback (most recent call last)
<ipython-input-7-50c190f51633> in <module>
----> 1 obj.full_clean()

~/.local/lib/python3.6/site-packages/django/db/models/base.py in full_clean(self, exclude, validate_unique)
   1236 
   1237         if errors:
-> 1238             raise ValidationError(errors)
   1239 
   1240     def clean_fields(self, exclude=None):

ValidationError: {'age': ['Your age should be 20 or equals to 20!']}
-----------------and we get ValidationError----------------
# when we try to fo the .full_clean() method
# we check the error if error doesnot error in this condition or other cases then we can obj.save() save the obj in the databases.

---------Whole Model Validaiton---------
# When we need to validate only some lines then we can use just like above small validators my_age_validators but for whole model 
. # for conditions if age is more than 40 then bio is compulsory.
# for these type of conditions django has provided clean() method :
 >>> def clean(self):
         if self.age > 40: 
               if not self.bio:  # (this means bio also added )
                     raise ValidationError("Bio is required because your age is more than 40 or equals to 40.")

>>>>>lets add another data in UserBio database.
    
Add user bio
Please correct the error below.
Name: erick
Email:erick@gmail.com
>>> error raised itself in form Your age should be 20 or equals to 20!
Age: 2
---------------------------------------------------
# As we have already passed the conditions for age less than 20
# so django automatically made the form validate using models validator.
------------------------------------------------
Please correct the error below.
Bio is required when your age is more than or equals to 40
Name:erick
Email:erick@gmail.com
Age:42
Bio:
# here django automatically detect the validationerror and found conditions is not meet as clean method is used above.
# only error came in bio field other name,email field hasnot came.
---------------------------------------------------------------

# from this what we knew is ----
 .clean() method                     .full_clean() method
# when we use shell                  # django automatically always call it
                                      # for whole model validation   
# we use/call full_clean to 
# make sure obj will be 
# save in database without error.

-----check the def full_clean()----method----------------


-------------MOre on Shell-------------------------
# at the above what we have is add, update and save the data on UserBio table 
# By using shell.
# we just used .all() method for calling all the table data
>>> python3 manage.py shell
>>> from UserBio.models import UserBio
>>> 
>>> UserBio.objects.all()
>>>Out[9]: <QuerySet [<UserBio: Ram>, <UserBio: Helen>, <UserBio: hari>, <UserBio: sita>, <UserBio: Jack>, <UserBio: erick>]>

------storing obj in qs variable and printing its type
>>>In [10]: qs = UserBio.objects.all()
>>> In [11]: type(qs)
>>> Out[11]: django.db.models.query.QuerySet

>>> qs = UserBio.Objects.filter(name="Rams")
>>> qs
>>> <QuerySet []>
----returned empty list because no such named Rams is available in our table database.

>>> qs = UserBio.objects.filter(name="Ram")
>>> qs
>>> <QuerySet [<UserBio: Ram>]>
-----returned Ram within a single list data type as Ram is in our database.

# example of chaining the queryset adding methods to methods.
---first we add anothe user data in table like we have Ram we add another rams

>>> qs = UserBio.objects.all()

>>>  qs
>>>  <QuerySet [<UserBio: Ram>, <UserBio: Helen>, <UserBio: hari>, <UserBio: sita>, <UserBio: Jack>, <UserBio: erick>, <UserBio: rams>]>

# printing in list data type

>>> list(qs)
>>>
[<UserBio: Ram>,
 <UserBio: Helen>,
 <UserBio: hari>,
 <UserBio: sita>,
 <UserBio: Jack>,
 <UserBio: erick>,
 <UserBio: rams>]

# now what I can do is put for loop in the objects?

>>> for obj in qs: print(obj.name)
Ram
Helen
hari
sita
Jack
erick
rams

-------------using exclude() method---------------------
>>> qs = UserBio.objects.exclude(name="Ram")
>>> qs
>>> <QuerySet [<UserBio: Helen>, <UserBio: hari>, <UserBio: sita>, <UserBio: Jack>, <UserBio: erick>, <UserBio: rams>]>
---note: rams is still there but Ram is not so we can say exact lookups is happening at background------------

----order_by()method--------
# maintining order and alphabetical with chaining method if required.
# qs = UserBio.objects.exclude(name='Rams'.order_by('-name')
In [14]: qs = UserBio.objects.exclude(name='Rams').order_by('-name')

In [15]: qs
Out[15]: <QuerySet [<UserBio: sita>, <UserBio: rams>, <UserBio: hari>, <UserBio: erick>, <UserBio: Ram>, <UserBio: Jack>, <UserBio: Helen>]>
# this will give just in reverse order or reverse alphabetical
----now if we want to make it in ascending order---------
----------------------
In [16]: qs = UserBio.objects.exclude(name='Rams').order_by('name')

In [17]: qs
Out[17]: <QuerySet [<UserBio: Helen>, <UserBio: Jack>, <UserBio: Ram>, <UserBio: erick>, <UserBio: hari>, <UserBio: rams>, <UserBio: sita>]>

>>>>Now it is randomness if we want random in result>>>>>>>
In [19]: qs = UserBio.objects.order_by('?')

In [20]: qs
Out[20]: <QuerySet [<UserBio: sita>, <UserBio: hari>, <UserBio: Helen>, <UserBio: Ram>, <UserBio: rams>, <UserBio: erick>, <UserBio: Jack>]>

-----But what about ordering done by Django?-------------
---does django does ordering by itself?---------
----for that to happen we create a meta class-------
-------and django will know and order the data as mentioned---
-------- given in meta class block code----------


->>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
qs.query
Out[23]: <django.db.models.sql.query.Query at 0x7f0380324390>

qs.query.__str__()
Out[25]: 'SELECT "modelextra_userbio"."id", "modelextra_userbio"."name", "modelextra_userbio"."email", "modelextra_userbio"."age", "modelextra_userbio"."bio" FROM "modelextra_userbio"'
# SQL  query will be sub select in string.

-----------------------------------------------------------------
 qs = UserBio.objects.filter(name="rams").query.__str__()
 qs
Out[27]: 'SELECT "modelextra_userbio"."id", "modelextra_userbio"."name", "modelextra_userbio"."email", "modelextra_userbio"."age", "modelextra_userbio"."bio" FROM "modelextra_userbio" WHERE "modelextra_userbio"."name" = rams'
>>>>>This type of query will generate>>>>>>>>>>

-----------------------------------------------------------------------------
In [28]: qs = UserBio.objects.filter(name='rams',age=10).query.__str__()

In [29]: qs
Out[29]: 'SELECT "modelextra_userbio"."id", "modelextra_userbio"."name", "modelextra_userbio"."email", "modelextra_userbio"."age", "modelextra_userbio"."bio" FROM "modelextra_userbio" WHERE ("modelextra_userbio"."age" = 10 AND "modelextra_userbio"."name" = rams)'

# Here our multiple arguments is separated by AND as we gave arguments (name, age)
--------------------------------------------------------------------------------


-----------Methods Doesnot Return QuerySet---------------------------
1..get()
 qs = UserBio.objects.get(id=1)

In [31]: qs
Out[31]: <UserBio: Ram>

In [32]: type(qs)
Out[32]: modelextra.models.UserBio
In [33]: qs.name
Out[33]: 'Ram'

In [34]: qs.age
Out[34]: 15

In [35]: qs.id

-----query doesnot exist not existing id---
In [36]: qs = UserBio.objects.get(id=80020)
---------------------------------------------------------------------------
DoesNotExist                              Traceback (most recent call last)
<ipython-input-36-14396e15c84a> in <module>
----> 1 qs = UserBio.objects.get(id=80020)

~/.local/lib/python3.6/site-packages/django/db/models/manager.py in manager_method(self, *args, **kwargs)
     83         def create_method(name, method):
     84             def manager_method(self, *args, **kwargs):
---> 85                 return getattr(self.get_queryset(), name)(*args, **kwargs)
     86             manager_method.__name__ = method.__name__
     87             manager_method.__doc__ = method.__doc__

~/.local/lib/python3.6/site-packages/django/db/models/query.py in get(self, *args, **kwargs)
    435             raise self.model.DoesNotExist(
    436                 "%s matching query does not exist." %
--> 437                 self.model._meta.object_name
    438             )
    439         raise self.model.MultipleObjectsReturned(

DoesNotExist: UserBio matching query does not exist.
-----------------------------------------------------------------
In [37]: qs = UserBio.objects.filter(id=50000)

In [38]: qs
Out[38]: <QuerySet []>
------------------------------------------------------------------
In [39]: qs = UserBio.objects.all()

In [40]: qs
Out[40]: <QuerySet [<UserBio: Ram>, <UserBio: Helen>, <UserBio: hari>, <UserBio: sita>, <UserBio: Jack>, <UserBio: erick>, <UserBio: rams>]>

In [41]: qs.first()
Out[41]: <UserBio: Ram>
# returns not a query set but an objects.---------
# or we can got qs.first().name
# or we can get last name with qs.last().name or just qs.last()
# ----then we get rams-----

# we have qs.count() returns the number of rows in table database.

# qs.delete() delete the objects of rows in the table database.

--------objects having same name with different case sensitive------
# for eg: two rams and Ram are in our table database.

# by default it will be .exact() method ie. it will return Ram

In [45]: qs = UserBio.objects.filter(name__exact='Ram')

In [46]: qs
Out[46]: <QuerySet [<UserBio: Ram>]>

----what if we need with case-sensitive --?---
# for that we have .__iexact() method

In [48]: qs = UserBio.objects.filter(name__iexact="rams")

In [49]: qs
Out[49]: <QuerySet [<UserBio: rams>]>
# in this way we can filter insensitive case and senstive case.






